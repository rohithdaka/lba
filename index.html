<!doctype html>
<script src="http://cdn.jsdelivr.net/mithril/0.2.0/mithril.min.js"></script>
<script>
    var lba = {};
    // Content for the page header
    var siteHeader = function(){
        return [
            m("title","Link Budget Analysis"),
            m("meta",{name: "author", content: "Rohith Daka"}),
            m("meta",{name: "keywords", content: "Channel Coding"}),
            m("link",{rel: "stylesheet", href: "lba.css"})
        ];
    };
    // calculator view component 
    var powerConversionUnits = [
        {'func': 'setdBW','suffix':'dBW'},
        {'func': 'setdBm','suffix':'dBm'},
        {'func': 'setmW','suffix':'mW'},
        {'func': 'setW','suffix':'W'}
    ];
    var powerConversion = function(power){
        return m("table", [
            m("caption","Power Units Convertor"),
            powerConversionUnits.map(function(unit,index){
                return m("tr",
                    m("td", [
                        m("input[type=number]", {
                            oninput: m.withAttr("value", power[unit.func]),
                            value: power[unit.suffix]
                        }),
                        unit.suffix
                    ])
                );
            })
        ]);
    };
    
    // link view component
    var linkParameters = [
        {'text':'Transmit Power','variable':'Pt','suffix':'dBm','calcvalue':false,'func':'setPt',},
        {'text':'Transmit Feeder/Pointing Losses','variable':'Lt','suffix':'dB','calcvalue':false,'func':'setLt'},
        {'text':'Transmit Antenna Gain','variable':'Gt','suffix':'dB','calcvalue':false,'func':'setGt'},
        {'text':'EIRP','variable':'EIRP','suffix':'dBm','calcvalue':true,'func':'setEIRP'},
        {'text':'Frequency','variable':'f','suffix':'MHz','calcvalue':false,'func':'setf'},
        {'text':'Distance','variable':'D','suffix':'km','calcvalue':false,'func':'setD'},
        {'text':'Path Loss','variable':'Lp','suffix':'dB','calcvalue':true,'func':'setLp'},
        {'text':'Atmospheric Attenuation','variable':'La','suffix':'dB','calcvalue':false,'func':'setLa'},
        {'text':'Receive Antenna Gain','variable':'Gr','suffix':'dB','calcvalue':false,'func':'setGr'},
        {'text':'Receive Feeder/Pointing Losses','variable':'Lr','suffix':'dB','calcvalue':false,'func':'setLr'},
        {'text':'Received Power','variable':'Pr','suffix':'dBm','calcvalue':true,'func':'setPr'},
        {'text':'Thermal Noise Temperature','variable':'Nt','suffix':'Kelvin','calcvalue':false,'func':'setNt'},
        {'text':'Bandwidth','variable':'BW','suffix':'KHz','calcvalue':false,'func':'setBW'},
        {'text':'Noise Figure','variable':'Nf','suffix':'dB','calcvalue':false,'func':'setNf'},
        {'text':'Total Noise Power','variable':'Np','suffix':'dBm','calcvalue':true,'func':'setNp'},
        {'text':'SNR','variable':'SNR','suffix':'dB','calcvalue':true,'func':'setSNR'},
        {'text':'Data Rate','variable':'R','suffix':'bps','calcvalue':false,'func':'setR'},
        {'text':'Eb/No','variable':'EbNo','suffix':'dB','calcvalue':true,'func':'setEbNo'}
    ];
    var linkCalculation = function(power){
        return m("table", [
            m("caption","Link Analysis"),
            linkParameters.map(function(param,index){
                return m("tr",
                    m("td",param.text),
                    m("td", [
                        m("input[type=number]", {
                            oninput: m.withAttr("value", power[param.func]),
                            value: power[param.variable],
                            readOnly: param.calcvalue
                        }),
                        param.suffix
                    ])
                );
            })
        ]);
        
    };
    
    // view of the body 
    var siteBody = function(power) {
        return [
            m("h1","Link Budget Analysis"),
            m("section#calculator]",powerConversion(power)),
            m("section#link",linkCalculation(power))
        ];
    }
    // Entire controller 
    lba.controller = function() {
  
        // Controller for Power conversion calculator 
        this.setdBm = function(dBm) {
            this.dBm = +dBm;
            this.mW = +(Math.pow(10,dBm/10));
            this.W = +(this.mW * Math.pow(10,-3));
            this.dBW = +(dBm - 30);
        }.bind(this);
  
        this.setmW = function(mW) {
            this.mW = +mW;
            this.dBm = +(10*Math.log(mW)/Math.log(10));
            this.W = +(mW * Math.pow(10,-3));
            this.dBW = +(this.dBm - 30);
        }.bind(this);
        
        this.setW = function(W){
            this.mW = +(W*Math.pow(10,3)).toFixed(2);
            this.dBm = +(10*Math.log(this.mW)/Math.log(10));
            this.W = +W;
            this.dBW = +(this.dBm - 30);
        }.bind(this);
        
        this.setdBW = function(dBW){
            this.dBW = +dBW;
            this.dBm = +dBW + 30;
            this.mW = +(Math.pow(10,this.dBm/10));
            this.W = +(this.mW*Math.pow(10,-3));
        }.bind(this);
    
        this.setdBm(0);
        
        //Controller for Link
        
        var K = 1.3806488e-23;
        this.setPt = function(Pt){
            this.Pt = +Pt;
            this.EIRP = +(this.Pt + this.Gt - this.Lt) ;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr -this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setGt = function(Gt){
            this.Gt = +Gt;
            this.EIRP = +(this.Pt + this.Gt - this.Lt) ;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr -this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setLt = function(Lt){
            this.Lt = +Lt;
            this.EIRP = +(this.Pt + this.Gt - this.Lt) ;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr -this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setEIRP = function(EIRP){
            this.EIRP = +EIRP;
        }.bind(this);
        this.setf = function(f){
            this.f = +f;
            this.Lp = +(20*Math.log(this.D) + 20*Math.log(this.f * Math.pow(10,-3)))/Math.log(10) + 92.45;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr - this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setD = function(D){
            this.D = +D;
            this.Lp = +(20*Math.log(this.D) + 20*Math.log(this.f * Math.pow(10,-3)))/Math.log(10) + 92.45;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr - this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setLp = function(Lp){
            this.Lp = +Lp;
        }.bind(this);
        this.setLa = function(La){
            this.La = +La;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr -this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setGr = function(Gr){
            this.Gr = +Gr;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr -this.Lr);
            this.Np = +((10*Math.log(this.Nt * this.BW * K))/Math.log(10) + 30 + 30 + this.Gr + this.Nf);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setLr = function(Lr){
            this.Lr = +Lr;
            this.Pr = +(this.EIRP - this.Lp - this.La + this.Gr -this.Lr);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setPr = function(Pr){
            this.Pr = +Pr;
        }.bind(this);
        this.setNt = function(Nt){
            this.Nt = +Nt;
            this.Np = +((10*Math.log(this.Nt * this.BW * 1000 * K))/Math.log(10) + 30 + this.Gr + this.Nf);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setNf = function(Nf){
            this.Nf = +Nf;
            this.Np = +((10*Math.log(this.Nt * this.BW * 1000 * K))/Math.log(10) + 30 + this.Gr + this.Nf);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10));
        }.bind(this);
        this.setBW = function(BW){
            this.BW = +BW;
            this.Np = +((10*Math.log(this.Nt * this.BW * 1000 * K))/Math.log(10) + 30 + this.Gr + this.Nf);
            this.SNR = +(this.Pr - this.Np);
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10)) ;
        }.bind(this);
        this.setNp = function(Np){
            this.Np = +Np;
        }.bind(this);
        this.setSNR = function(SNR){
            this.SNR = +SNR;
        }.bind(this);
        this.setR = function(R){
            this.R = +R;
            this.EbNo = +( this.SNR - (10*Math.log(this.R / (this.BW * 1000) ) )/Math.log(10)) ;
        }.bind(this);
        this.setEbNo = function(EbNo){
            this.EbNo = +EbNo;
        }.bind(this);
        
        
        
        
        
        
        
        

        
    };
    
    // View of the entire site
    lba.view = function(power) {
        return m("html", [
            m("head", siteHeader()),
            m("body", siteBody(power))
        ]);
    };

    // initialising the app
    m.mount(document, lba);
    
</script>